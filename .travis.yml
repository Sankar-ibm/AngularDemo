# test
services:
  - docker

script: "echo 'Building Docker image with tags'"

after_success:
  - export DEPLOY_TIMESTAMP=`date +'%Y%m%d-%H%M%S'`
  # Creating a custom tag for the docker image in addition to the default "latest" tag.
  - docker build -t web-frontend:$DEPLOY_TIMESTAMP-$TRAVIS_BUILD_NUMBER-$TRAVIS_BRANCH -t web-frontend:latest .
  # script: chmod +x ./scripts/* && ./scripts/execute.sh <Cluster Namespace> <Container Registry Namespace>
  - ./build_and_push_image.sh web-frontend-dev

deploy:
  provider: openshift
  server: https://c100-e.us-east.containers.cloud.ibm.com:31217
  token: OLHiAQNW30OQCyKGNCmzDoStW1mgSnVZis82X6q1_WU
  project: csankara-in
  - docker login -u iamapikey -p 6bD6gn-hdjsbSuCNMB0tdjRyGqLV27tA0MNYUQT74izj us.icr.io
  - oc create secret generic regtoken --from-file .dockerconfigjson=${XDG_RUNTIME_DIR}/containers/auth.json --type kubernetes.io/dockerconfigjson
  - oc import-image web-frontend --confirm --reference-policy local --from us.icr.io/web-frontend-dev/web-frontend:latest
  - oc new-app --as-deployment-config -i web-frontend
  edge: true
  
